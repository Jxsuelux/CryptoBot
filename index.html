<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CryptoBot Pro V4</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
  body{
    font-family:'Inter',sans-serif;
    margin:0; padding:0;
    display:flex; flex-direction:column; height:100vh;
    background:#111A23; color:#fff;
  }
  header{
    background:#252D3A;
    color:#fff;
    padding:1rem;
    font-size:1.6rem;
    font-weight:600;
    text-align:left;
    display:flex;
    align-items:center;
    justify-content:space-between;
    box-shadow:0 2px 6px rgba(0,0,0,0.5);
    position:relative;
  }
  #menu-btn{
    background:none;
    border:none;
    color:#fff;
    font-size:1.5rem;
    cursor:pointer;
    padding:0 0.5rem;
  }
  #dropdown-menu{
    display:none;
    position:absolute;
    right:1rem; top:3rem;
    background:#252D3A;
    border:1px solid #333;
    border-radius:6px;
    padding:0.5rem 0;
    z-index:10;
    box-shadow:0 2px 6px rgba(0,0,0,0.4);
  }
  #dropdown-menu button{
    display:block;
    width:100%;
    background:none;
    border:none;
    color:#fff;
    padding:0.5rem 1rem;
    text-align:left;
    cursor:pointer;
  }
  #dropdown-menu button:hover{
    background:#1f6feb;
  }
  #chat-container{
    flex:1;
    padding:1rem;
    overflow-y:auto;
    display:flex;
    flex-direction:column;
    gap:0.6rem;
    scroll-behavior:smooth;
    min-height:200px;
  }
  .message{
    max-width:70%;
    min-height:24px;
    padding:0.8rem 1rem;
    border-radius:14px;
    word-wrap:break-word;
    font-size:0.95rem;
    line-height:1.4;
    position:relative;
    box-shadow:0 2px 6px rgba(0,0,0,0.4);
  }
  .user{
    background:linear-gradient(120deg,#0066ff,#3399ff);
    align-self:flex-end;
    border-bottom-right-radius:2px;
  }
  .bot{
    background:rgba(40,42,50,0.95);
    align-self:flex-start;
    border-bottom-left-radius:2px;
  }
  #input-container{
    display:flex;
    padding:0.6rem;
    border-top:1px solid #222;
    background:#111A23;
  }
  #user-input{
    flex:1;
    padding:0.8rem 1rem;
    border:1px solid #222;
    border-radius:25px;
    font-size:1rem;
    outline:none;
    background:#16171b;
    color:#fff;
  }
  #send-btn{
    margin-left:0.5rem;
    padding:0.8rem 1.3rem;
    background:#0066ff;
    color:#fff;
    border:none;
    border-radius:25px;
    font-size:1rem;
    cursor:pointer;
    transition:0.2s;
  }
  #send-btn:hover{
    background:#3399ff;
  }
  .option-btn{
    background: rgba(36,48,62,0.7);
    color:#fff;
    border:none;
    border-radius:20px;
    padding:0.6rem 1rem;
    margin:0.3rem;
    cursor:pointer;
    font-size:0.9rem;
    transition:0.3s;
    opacity:0;
    transform:translateY(20px);
  }
  .option-btn.show{
    opacity:1;
    transform:translateY(0);
  }
  .buttons-grid{
    display:flex;
    flex-wrap:wrap;
    gap:0.4rem;
    max-width:600px;
    background:none; /* quita el cuadro feo */
    padding:0;
    margin-top:8px;
  }
  .prob-bar-container{
    width:100%;
    background:#222;
    height:12px;
    border-radius:6px;
    margin-top:6px;
    overflow:hidden;
  }
  .prob-bar{
    height:12px;
    border-radius:6px;
    background:linear-gradient(90deg,#00ff99,#00ccff);
    width:0%;
    transition:width 1s ease-in-out;
  }
  #chat-container::-webkit-scrollbar{
    width:8px;
  }
  #chat-container::-webkit-scrollbar-track{
    background:#111A23;
  }
  #chat-container::-webkit-scrollbar-thumb{
    background:#333;
    border-radius:4px;
  }
</style>
</head>
<body>
<header>
  CryptoBot Pro V4
  <div>
    <button id="menu-btn">â‹®</button>
    <div id="dropdown-menu">
      <button id="new-chat-btn">New chat</button>
    </div>
  </div>
</header>

<div id="chat-container"></div>

<div id="input-container">
  <input type="text" id="user-input" placeholder="Escribe tu mensaje...">
  <button id="send-btn">Enviar</button>
</div>

<script>
const chatContainer=document.getElementById("chat-container");
const userInput=document.getElementById("user-input");
const sendBtn=document.getElementById("send-btn");
const menuBtn=document.getElementById("menu-btn");
const dropdownMenu=document.getElementById("dropdown-menu");
const newChatBtn=document.getElementById("new-chat-btn");

let step="start";
let currentMarket=null;

const activos={
  "Cryptos":["Bitcoin","Ethereum","XRP","Cardano","Solana","Dogecoin","Litecoin","Polkadot","Avalanche","Shiba Inu","Chainlink","Tron","Polygon","Stellar","Cosmos","Uniswap","VeChain","NEAR","Aptos","Arbitrum"],
  "Forex":["USD/MXN","USD/JPY","EUR/USD","EUR/CAD","GBP/USD","AUD/USD","NZD/USD","USD/CHF","USD/CAD","EUR/GBP","EUR/JPY","GBP/JPY","AUD/JPY","CAD/JPY","CHF/JPY","EUR/AUD","NZD/JPY","USD/SEK","USD/NOK"],
  "Stock":["Tesla","Apple","Microsoft","Amazon","Google","Facebook","NVIDIA","Netflix","AMD","Intel","Coca-Cola","PepsiCo","Disney","Adobe","Visa","MasterCard","Pfizer","Nike","McDonald's","eBay"]
};

// Toggle dropdown
menuBtn.addEventListener("click",()=>{dropdownMenu.style.display = dropdownMenu.style.display==="block"?"none":"block";});

// Reiniciar chat
newChatBtn.addEventListener("click",()=>{
  chatContainer.innerHTML="";
  step="start";
  currentMarket=null;
  addMessage('Hola, soy CryptoBot Pro V4. Escribe "/start" para comenzar.', 'bot');
  dropdownMenu.style.display="none";
});

// Funciones principales
function addMessage(text,sender){
  const msg=document.createElement("div");
  msg.classList.add("message",sender);
  chatContainer.appendChild(msg);
  chatContainer.scrollTop=chatContainer.scrollHeight;
  if(sender==="bot"){
    let i=0;
    const interval=setInterval(()=>{
      if(i>=text.length){ clearInterval(interval); return; }
      msg.textContent+=text[i]; i++;
      chatContainer.scrollTop=chatContainer.scrollHeight;
    },25);
  } else {
    msg.textContent=text;
  }
}

function addButtons(options,onClick){
  const wrapper=document.createElement("div");
  wrapper.classList.add("buttons-grid");
  options.forEach((opt,i)=>{
    const btn=document.createElement("button");
    btn.classList.add("option-btn");
    btn.textContent=opt;
    btn.onclick=()=>onClick(opt);
    wrapper.appendChild(btn);
    setTimeout(()=>btn.classList.add("show"),i*50);
  });
  chatContainer.appendChild(wrapper);
  chatContainer.scrollTop=chatContainer.scrollHeight;
}

function showProbBar(prob){
  const container=document.createElement("div");
  container.classList.add("prob-bar-container");
  const bar=document.createElement("div");
  bar.classList.add("prob-bar");
  container.appendChild(bar);
  chatContainer.appendChild(container);
  chatContainer.scrollTop=chatContainer.scrollHeight;
  setTimeout(()=>{ bar.style.width=prob+"%"; },100);
}

function startAnalysis(asset){
  const loadingMsg=document.createElement("div");
  loadingMsg.classList.add("message","bot");
  chatContainer.appendChild(loadingMsg);
  let dots=0;
  const interval=setInterval(()=>{
    dots=(dots+1)%4;
    loadingMsg.textContent="Analizando el mercado" + ".".repeat(dots);
    chatContainer.scrollTop=chatContainer.scrollHeight;
  },500);

  setTimeout(()=>{
    clearInterval(interval);
    loadingMsg.remove();
    addMessage(`Resultado del bot: ${Math.random()<0.5?"ðŸ“ˆ SubirÃ¡":"ðŸ“‰ BajarÃ¡"}`,"bot");
    showProbBar(Math.floor(Math.random()*5+48));
    step="restart";
    setTimeout(()=>{
      addMessage("Â¿Quieres analizar otro activo?","bot");
      addButtons(["SÃ­","No"],handleRestart);
    },500);
  },2500);
}

function handleMarketSelection(market){
  addMessage(market,"user");
  currentMarket=market;
  setTimeout(()=>{
    addMessage(`Â¿QuÃ© activo de ${market} deseas analizar?`,"bot");
    addButtons(activos[market],asset=>{addMessage(asset,"user");startAnalysis(asset);});
  },500);
}

function handleRestart(choice){
  addMessage(choice,"user");
  if(choice==="SÃ­"){
    step="asset";
    addMessage("Selecciona nuevamente el mercado:","bot");
    addButtons(["Forex","Cryptos","Stock"],handleMarketSelection);
  } else {
    addMessage("Gracias por usar CryptoBot ðŸ’¹ Â¡Vuelve pronto!","bot");
    step="end";
  }
}

function sendMessage(){
  const text=userInput.value.trim();
  if(!text) return;
  addMessage(text,"user");
  userInput.value="";
  if(step==="start" && text.toLowerCase()==="/start"){
    addMessage("Â¿QuÃ© activos usarÃ¡s?","bot");
    addButtons(["Forex","Cryptos","Stock"],handleMarketSelection);
    step="asset";
  } else if(step==="start"){
    addMessage('Escribe "/start" para iniciar el servicio.',"bot");
  }
}

// Listeners
sendBtn.addEventListener("click",sendMessage);
userInput.addEventListener("keydown",e=>{if(e.key==="Enter")sendMessage();});

// Mensaje inicial al cargar la pÃ¡gina
window.addEventListener("load", ()=>{
    addMessage('Hola, soy CryptoBot Pro V4. Escribe "/start" para comenzar.', 'bot');
});
</script>
</body>
</html>
